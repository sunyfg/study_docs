# JS 的垃圾回收机制

## 一、什么是内存泄漏

程序的运行需要内存，程序运行中的各种操作需要消耗资源和内存，程序运行中生成的各种数据也需要内存。若不及时释放内存，则内存的占用越来越高，轻则影响程序和系统的性能，重则导致进程或系统的崩溃。 

没有及时释放不再使用的内存，就称为**内存泄漏**。

对于有的语言能够进行自动化内存管理，称为**垃圾回收机制**

## 二、哪些内容是“垃圾”？

JS的垃圾回收机制**会定期（周期性）找出那些不再用到的内存（变量）**，然后释放其内存。 很简单，对于我们不再使用的内容，就会视为垃圾处理掉。而对于不再使用的值，则会被垃圾回收。（注意可访问性）

- 有用的值： 
  - 本地函数的局部变量和参数
  - 调用链上的其他函数的变量和参数
  - 全局变量
  - 可访问的值
- 无用的值： 
  - 地址或值为 null 的值
  - 函数的局部作用域中的变量和参数（函数完成后）

## JS 回收方式

### 1. “标记” 清除

这是JS中最常用的垃圾回收方式，它通过给所有的变量都标上一个标记，然后再追溯到他们的引用并继续标记，就这样一直标记下去，一直到有未访问（不可访问）的引用为止，除了标记了的对象以外，其他所有对象都被删除。

- 每个对象都不会被标记两次
- 从根访问开始标记

### 2. 引用计数

根据被引用的次数。当声明一个变量并将一个引用类型赋值给该变量时，这个值得引用次数就 +1，相反，如果包含对这个值引用的变量又取得了另外一个值，这个值得引用次数就 -1，当这个值得引用次数变为0的时候，就说明没有办法再访问这个值了，因而就可以将其所占的内存空间给收回来。这样，垃圾收集器下次再运行时，就会释放哪些引用次数为0所占的内存。

有一个缺点：无法清理**循环引用**数据。